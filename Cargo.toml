[workspace]
members = [
 "vm-common",
 "vm-codegen",
 "vm-core",
 "vm-interface",
 "vm-ir",
 "vm-mem",
 "vm-frontend-arm64",
 "vm-frontend-x86_64",
 "vm-frontend-riscv64",
 "vm-engine-interpreter",
 "vm-engine-jit",
 "vm-accel",
 "vm-device",
 "vm-simd",
 "vm-osal",
 "vm-passthrough",
 "vm-boot",
 "vm-monitor",
 "vm-adaptive",       
 "vm-gpu",         
 "vm-debug",
 "vm-runtime",
  "vm-plugin",
  # "vm-encoding",  # 已合并到 vm-core/src/encoding
  # "vm-register",  # 已合并到 vm-core/src/register
  # "vm-memory-access",  # 已合并到 vm-core/src/memory_access
  # "vm-instruction-patterns",  # 已合并到 vm-ir
  # "vm-optimization",  # 已合并到 vm-engine-jit
  "vm-error",
  "vm-validation",
  "vm-resource",
 # "async-executor",  # 已合并到 vm-runtime/src/async_executor
 # "coroutine-scheduler",  # 已合并到 vm-runtime/src/coroutine_scheduler_legacy
 # "gc-optimizer",  # 已合并到 vm-mem/src/gc_optimizer
 # "memory-optimizer",  # 已合并到 vm-mem/src/memory_optimizer
 # "ml-guided-compiler",  # 已合并到 vm-engine-jit/src/ml_guided_compiler
 # "pgo-optimizer",  # 已合并到 vm-engine-jit/src/pgo_optimizer
 "security-sandbox",
 "syscall-compat",
 "distributed-executor",
]
resolver = "2"

[workspace.dependencies]
# 核心基础设施
serde = { version = "1.0", features = ["derive"] }
serde_json = "1.0"
serde_with = "3.16"
thiserror = "2.0"
tracing = "0.1"
log = "0.4"
parking_lot = "0.12"
anyhow = "1.0"
libc = "0.2"
bincode = { version = "2.0.1", features = ["serde"] }
uuid = { version = "1.19", features = ["v4", "serde"] } # 当前最新稳定版本 1.19.0
chrono = { version = "0.4", features = ["serde"] }
rand = "0.9"
fastrand = "2.3"
num_cpus = "1.17"
rayon = "1.11"

# 异步与并发
tokio = { version = "1.48", features = ["full"] } # 当前最新稳定版本 1.48.0
futures = "0.3"
async-trait = "0.1"

# VM 核心组件
vm-ir = { path = "vm-ir" }

# 编译后端 (Cranelift 优先)
cranelift = "0.126"
cranelift-module = "0.126"
cranelift-codegen = "0.126"
cranelift-frontend = "0.126"
cranelift-jit = "0.126"
cranelift-native = "0.126"
target-lexicon = "0.13"
llvm-sys = "211"
inkwell = "0.7"

# 其他公共库
criterion = { version = "0.8", features = ["html_reports"] }
sqlx = { version = "0.8", features = ["runtime-tokio-rustls", "postgres", "chrono", "json", "uuid"] }

[workspace.metadata.docs]
all-features = true
rustdoc-args = ["--cfg", "docsrs"]

[workspace.package]
version = "0.1.0"
edition = "2024"
authors = ["VM Development Team"]
license = "MIT OR Apache-2.0"
repository = "https://github.com/example/vm"
documentation = "https://docs.rs/vm"
readme = "README.md"
keywords = ["virtual-machine", "emulator", "risc-v", "arm64", "jit"]
categories = ["emulators", "virtualization"]

[profile.dev]
opt-level = 0
debug = true
debug-assertions = true
overflow-checks = true
lto = false
incremental = true
# 减少 codegen-units 可以提升运行时性能，但会增加编译时间
# 设置为16是一个平衡点，既保证编译速度又不会过度影响性能
codegen-units = 16
panic = "unwind"

[profile.test]
inherits = "dev"
opt-level = 1
debug = true
debug-assertions = true
overflow-checks = true
lto = false
incremental = true
# 测试配置：使用更少的 codegen-units 以提升测试执行速度
codegen-units = 16

[profile.bench]
opt-level = 3
debug = false
debug-assertions = false
overflow-checks = false
lto = "thin"
incremental = false
codegen-units = 1

[profile.release]
opt-level = 3
debug = false
debug-assertions = false
overflow-checks = false
lto = "thin"
incremental = false
codegen-units = 1
panic = "unwind"
