# é˜¶æ®µ 4-7ï¼šå‰©ä½™è®¡åˆ’æ±‡æ€»

## æ¦‚è¿°

æœ¬æ–‡æ¡£æ±‡æ€»å‰©ä½™çš„å®æ–½é˜¶æ®µï¼šæ¨¡å—é‡æ„ã€æ¡ä»¶ç¼–è¯‘ç®€åŒ–ã€æµ‹è¯•è¦†ç›–ç‡æå‡ã€æ–‡æ¡£å®Œå–„å’Œæœ€ç»ˆéªŒè¯ã€‚

---

## é˜¶æ®µ 4ï¼šæ¨¡å—é‡æ„è®¡åˆ’

### ç›®æ ‡
å‡å°‘ crate æ•°é‡ï¼Œç®€åŒ–ä¾èµ–å…³ç³»

### ä¼˜å…ˆçº§
ğŸŸ¡ **P1 - ä¸­ä¼˜å…ˆçº§**ï¼ˆå½±å“å¯ç»´æŠ¤æ€§å’Œç¼–è¯‘æ—¶é—´ï¼‰

### æ—¶é—´ä¼°ç®—
2-3 å‘¨

### å®æ–½æ­¥éª¤

#### æ­¥éª¤ 1ï¼šåˆå¹¶ vm-engine å’Œ vm-engine-jitï¼ˆ3-4 å¤©ï¼‰

**ç›®æ ‡**ï¼šåˆ›å»ºç»Ÿä¸€çš„ vm-execution crate

**æ–° crate ç»“æ„**ï¼š
```toml
# crates/execution/vm-execution/Cargo.toml
[package]
name = "vm-execution"
version = "0.1.0"
edition = "2024"

[lib]
path = "src/lib.rs"

[dependencies]
vm-build-deps = { path = "../../architecture/vm-build-deps" }
vm-core = { path = "../../core/vm-core" }
vm-ir = { path = "../../core/vm-ir" }
vm-mem = { path = "../../memory/vm-mem" }
vm-accel = { path = "../../platform/vm-accel" }
vm-monitor = { path = "../../runtime/vm-monitor" }

[features]
default = ["interpreter", "jit"]
interpreter = []
jit = []
async = ["vm-core/async"]
```

**æºæ–‡ä»¶ç»“æ„**ï¼š
```
crates/execution/vm-execution/src/
â”œâ”€â”€ lib.rs              # ç»Ÿä¸€å¯¼å‡º
â”œâ”€â”€ interpreter/         # è§£é‡Šå™¨å®ç°ï¼ˆä» vm-engineï¼‰
â”œâ”€â”€ jit/                 # JIT å®ç°ï¼ˆä» vm-engine-jitï¼‰
â”‚   â”œâ”€â”€ mod.rs
â”‚   â”œâ”€â”€ tiered/
â”‚   â”œâ”€â”€ cache/
â”‚   â””â”€â”€ optimizer/
â””â”€â”€ unified_executor.rs   # ç»Ÿä¸€æ‰§è¡Œå™¨
```

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] åˆ›å»º vm-execution crate ç»“æ„
- [ ] è¿ç§» vm-engine çš„è§£é‡Šå™¨ä»£ç 
- [ ] è¿ç§» vm-engine-jit çš„ JIT ä»£ç 
- [ ] å®ç°ç»Ÿä¸€æ‰§è¡Œå™¨æ¥å£
- [ ] æ›´æ–°æ‰€æœ‰ä¾èµ–è·¯å¾„
- [ ] ç¼–è¯‘éªŒè¯
- [ ] æµ‹è¯•éªŒè¯

#### æ­¥éª¤ 2ï¼šåˆå¹¶è®¾å¤‡ cratesï¼ˆ2-3 å¤©ï¼‰

**ç›®æ ‡**ï¼šå°† vm-graphics, vm-smmu, vm-soc åˆå¹¶åˆ° vm-devices

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] åˆ›å»º vm-devices/Cargo.toml
- [ ] è¿ç§» vm-graphics ä»£ç 
- [ ] è¿ç§» vm-smmu ä»£ç 
- [ ] è¿ç§» vm-soc ä»£ç 
- [ ] ç»Ÿä¸€è®¾å¤‡æ¥å£
- [ ] æ›´æ–°æ‰€æœ‰ä¾èµ–è·¯å¾„
- [ ] ç¼–è¯‘éªŒè¯
- [ ] æµ‹è¯•éªŒè¯

#### æ­¥éª¤ 3ï¼šåˆå¹¶å…¼å®¹æ€§ cratesï¼ˆ1-2 å¤©ï¼‰

**ç›®æ ‡**ï¼šå°† security-sandbox å’Œ syscall-compat åˆå¹¶ä¸º vm-compat

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] åˆ›å»º vm-compat/Cargo.toml
- [ ] è¿ç§» security-sandbox ä»£ç 
- [ ] è¿ç§» syscall-compat ä»£ç 
- [ ] ç»Ÿä¸€æ¥å£
- [ ] æ›´æ–°æ‰€æœ‰ä¾èµ–è·¯å¾„
- [ ] ç¼–è¯‘éªŒè¯
- [ ] æµ‹è¯•éªŒè¯

#### æ­¥éª¤ 4ï¼šæ›´æ–° workspace é…ç½®ï¼ˆåŠå¤©ï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] æ›´æ–°æ ¹ Cargo.toml çš„ workspace members
- [ ] ç§»é™¤åˆå¹¶çš„ crates
- [ ] æ·»åŠ æ–°çš„ crates
- [ ] éªŒè¯ workspace ç»“æ„

**ä¿®æ”¹å**ï¼š
```toml
[workspace]
members = [
    # ============================================================================
    # Core Libraries
    # ============================================================================
    "crates/core/vm-core",
    "crates/core/vm-ir",
    "crates/core/vm-boot",

    # ============================================================================
    # Execution Engines
    # ============================================================================
    "crates/execution/vm-execution",
    "crates/execution/vm-frontend",

    # ============================================================================
    # Memory Management
    # ============================================================================
    "crates/memory/vm-mem",
    "crates/memory/vm-gc",
    "crates/memory/vm-optimizers",

    # ============================================================================
    # Platform Layer
    # ============================================================================
    "crates/platform/vm-accel",
    "crates/platform/vm-platform",
    "crates/platform/vm-osal",

    # ============================================================================
    # Device Emulation
    # ============================================================================
    "crates/devices/vm-devices",

    # ============================================================================
    # Runtime Services
    # ============================================================================
    "crates/runtime/vm-service",
    "crates/runtime/vm-plugin",
    "crates/runtime/vm-monitor",

    # ============================================================================
    # Compatibility Layer
    # ============================================================================
    "crates/compatibility/vm-compat",

    # ============================================================================
    # Architecture Support
    # ============================================================================
    "crates/architecture/vm-cross-arch-support",
    "crates/architecture/vm-codegen",
    "crates/architecture/vm-build-deps",

    # ============================================================================
    # Tools
    # ============================================================================
    "tools/cli",
    "tools/desktop",
    "tools/debug",
    "tools/passthrough",

    # ============================================================================
    # Research & Experiments
    # ============================================================================
    "research/perf-bench",
    "research/tiered-compiler",
    "research/parallel-jit",
    "research/benches",
]
```

#### æ­¥éª¤ 5ï¼šæ›´æ–°æ‰€æœ‰ä¾èµ–å¼•ç”¨ï¼ˆ2-3 å¤©ï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] æœç´¢æ‰€æœ‰å¼•ç”¨ vm-engine çš„æ–‡ä»¶
- [ ] æ›´æ–°ä¸º vm-execution
- [ ] æœç´¢æ‰€æœ‰å¼•ç”¨ vm-device çš„æ–‡ä»¶
- [ ] æ›´æ–°ä¸º vm-devices
- [ ] æœç´¢æ‰€æœ‰å¼•ç”¨ security-sandbox çš„æ–‡ä»¶
- [ ] æ›´æ–°ä¸º vm-compat
- [ ] ç¼–è¯‘éªŒè¯
- [ ] æµ‹è¯•éªŒè¯

#### æ­¥éª¤ 6ï¼šæ€§èƒ½å›å½’æµ‹è¯•ï¼ˆ1 å¤©ï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] è¿è¡Œé‡æ„å‰æ€§èƒ½åŸºå‡†
- [ ] è¿è¡Œé‡æ„åæ€§èƒ½åŸºå‡†
- [ ] å¯¹æ¯”æ€§èƒ½æ•°æ®
- [ ] è¯†åˆ«æ€§èƒ½å›å½’
- [ ] ä¿®å¤å›å½’ï¼ˆå¦‚éœ€è¦ï¼‰

**åŸºå‡†æµ‹è¯•**ï¼š
```bash
# ç¼–è¯‘ä¼˜åŒ–ç‰ˆæœ¬
cargo build --workspace --release

# è¿è¡Œæ€§èƒ½åŸºå‡†
cargo bench --workspace --all-features

# ä¿å­˜åŸºå‡†ç»“æœ
cargo bench --workspace --all-features -- --save-baseline vm-baseline

# å¯¹æ¯”åŸºå‡†
cargo bench --workspace --all-features -- --baseline vm-baseline
```

### æˆåŠŸæ ‡å‡†

- [ ] Workspace members ä» 24 å‡å°‘åˆ° 20
- [ ] æ‰€æœ‰ä¾èµ–å¼•ç”¨å·²æ›´æ–°
- [ ] æ‰€æœ‰ crate æˆåŠŸç¼–è¯‘
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] æ— æ€§èƒ½å›å½’ï¼ˆ<2%ï¼‰

---

## é˜¶æ®µ 5ï¼šæ¡ä»¶ç¼–è¯‘ç®€åŒ–è®¡åˆ’

### ç›®æ ‡
ç®€åŒ–ç‰¹æ€§é…ç½®ï¼Œå‡å°‘ `#[cfg(feature = "...")]` ä½¿ç”¨

### ä¼˜å…ˆçº§
ğŸŸ¡ **P1 - ä¸­ä¼˜å…ˆçº§**ï¼ˆå½±å“å¯ç»´æŠ¤æ€§ï¼‰

### æ—¶é—´ä¼°ç®—
1-2 å‘¨

### å®æ–½æ­¥éª¤

#### æ­¥éª¤ 1ï¼šç‰¹æ€§å®¡æŸ¥å’Œåˆ†ç±»ï¼ˆ1 å¤©ï¼‰

**å½“å‰ç‰¹æ€§ç»Ÿè®¡**ï¼š
- 72 ä¸ªæ–‡ä»¶ä½¿ç”¨ `#[cfg(feature = "...")]`
- ç‰¹æ€§ç±»åˆ«ï¼š
  - asyncï¼š30+ å¤„
  - x86_64/arm64/riscv64ï¼š15 å¤„
  - simdï¼š8 å¤„
  - kvm/hvf/whpï¼š40+ å¤„
  - optimizationsï¼š10 å¤„
  - performanceï¼š25+ å¤„

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] ç»Ÿè®¡æ‰€æœ‰ç‰¹æ€§ä½¿ç”¨
- [ ] åˆ†ç±»ç‰¹æ€§ç±»å‹
- [ ] è¯†åˆ«æ¨¡ç³Šç‰¹æ€§
- [ ] è¯†åˆ«è¿‡åº¦ä½¿ç”¨çš„ç‰¹æ€§

#### æ­¥éª¤ 2ï¼šé‡å®šä¹‰ç‰¹æ€§ï¼ˆ2-3 å¤©ï¼‰

**æ–°çš„ç‰¹æ€§ç»“æ„**ï¼š

```toml
# Cargo.toml (workspace)
[workspace.dependencies]
# ä¿æŒç°æœ‰ä¾èµ–

[features]
# é»˜è®¤ç‰¹æ€§
default = ["std", "async", "cranelift", "kvm", "simd", "tlb-cache"]

# æ ‡å‡†åº“æ”¯æŒ
std = []

# å¼‚æ­¥è¿è¡Œæ—¶
async = [
    "tokio/rt-multi-thread",
    "tokio/macros",
    "tokio/sync",
    "tokio/time",
]

# JIT åç«¯é€‰æ‹©
cranelift = [
    "dep:cranelift-codegen",
    "dep:cranelift-frontend",
    "dep:cranelift-module",
    "dep:cranelift-native",
]

# å¹³å°æ”¯æŒ
kvm = ["dep:kvm-ioctls", "dep:kvm-bindings"]
hvf = []
whp = ["dep:windows"]

# ä¼˜åŒ–ç‰¹æ€§
simd = ["dep:wide"]
tlb-cache = []
numa = []
prefetch = []

# æŒ‡ä»¤é›†æ‰©å±•
x86-avx = []
x86-avx512 = []
arm-neon = []
arm-sve = []
riscv-vector = []

# è®¾å¤‡æ”¯æŒ
gpu = ["wgpu", "winit", "pollster"]
smoltcp = ["dep:smoltcp"]
smmu = []
```

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] å®šä¹‰æ˜ç¡®çš„ç‰¹æ€§åç§°
- [ ] ç§»é™¤æ¨¡ç³Šç‰¹æ€§ï¼ˆperformance, optimizationsï¼‰
- [ ] ä½¿ç”¨ç‰¹æ€§ä¾èµ–å…³ç³»
- [ ] æ–‡æ¡£åŒ–æ‰€æœ‰ç‰¹æ€§

#### æ­¥éª¤ 3ï¼šä½¿ç”¨ trait æŠ½è±¡å¼‚æ­¥/åŒæ­¥ï¼ˆ3-4 å¤©ï¼‰

**ç›®æ ‡**ï¼šå‡å°‘ `#[cfg(feature = "async")]` ä½¿ç”¨

**æŠ½è±¡æ¥å£è®¾è®¡**ï¼š

```rust
// ç»Ÿä¸€å†…å­˜è®¿é—®æ¥å£
pub trait MemoryReader {
    async fn read_u8(&self, addr: u64) -> VmResult<u8>;
    async fn read_u16(&self, addr: u64) -> VmResult<u16>;
    async fn read_u32(&self, addr: u64) -> VmResult<u32>;
    async fn read_u64(&self, addr: u64) -> VmResult<u64>;
}

// å¼‚æ­¥å®ç°
pub struct AsyncMemoryReader {
    mmu: Arc<AsyncMmu>,
}

#[async_trait]
impl MemoryReader for AsyncMemoryReader {
    async fn read_u8(&self, addr: u64) -> VmResult<u8> {
        self.mmu.read_u8(addr).await
    }
    // ... å…¶ä»–æ–¹æ³•
}

// åŒæ­¥å®ç°
pub struct SyncMemoryReader {
    mmu: Arc<Mutex<SyncMmu>>,
}

#[async_trait(?Send)]
impl MemoryReader for SyncMemoryReader {
    async fn read_u8(&self, addr: u64) -> VmResult<u8> {
        let mmu = self.mmu.lock().unwrap();
        Ok(mmu.read_u8(addr))
    }
    // ... å…¶ä»–æ–¹æ³•
}
```

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] è®¾è®¡ç»Ÿä¸€çš„ trait æ¥å£
- [ ] å®ç°å¼‚æ­¥ç‰ˆæœ¬
- [ ] å®ç°åŒæ­¥ç‰ˆæœ¬
- [ ] æ›´æ–°æ‰€æœ‰ä½¿ç”¨ç‚¹
- [ ] ç§»é™¤æ¡ä»¶ç¼–è¯‘
- [ ] æµ‹è¯•ä¸¤ç§å®ç°

#### æ­¥éª¤ 4ï¼šç®€åŒ–æ¡ä»¶ç¼–è¯‘ä½¿ç”¨ï¼ˆ3-4 å¤©ï¼‰

**é‡å†™å‰**ï¼š
```rust
#[cfg(feature = "async")]
pub async fn read_memory(&self, addr: u64) -> VmResult<u64> {
    self.mmu.read(addr).await
}

#[cfg(not(feature = "async"))]
pub fn read_memory(&self, addr: u64) -> VmResult<u64> {
    self.mmu.read(addr)
}
```

**é‡å†™å**ï¼š
```rust
pub async fn read_memory(&self, addr: u64) -> VmResult<u64> {
    self.memory_reader.read_u64(addr).await
}
```

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] ä½¿ç”¨ trait æ›¿ä»£æ¡ä»¶ç¼–è¯‘
- [ ] å‡å°‘ 50% çš„ `#[cfg(feature = "...")]` ä½¿ç”¨
- [ ] ç»Ÿä¸€ä»£ç è·¯å¾„
- [ ] æµ‹è¯•æ‰€æœ‰ç‰¹æ€§ç»„åˆ

#### æ­¥éª¤ 5ï¼šæµ‹è¯•æ‰€æœ‰ç‰¹æ€§ç»„åˆï¼ˆ1 å¤©ï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] æµ‹è¯• default ç‰¹æ€§
- [ ] æµ‹è¯• async ç‰¹æ€§
- [ ] æµ‹è¯• sync æ¨¡å¼ï¼ˆç¦ç”¨ asyncï¼‰
- [ ] æµ‹è¯•å„å¹³å°ç‰¹æ€§ï¼ˆkvm, hvf, whpï¼‰
- [ ] æµ‹è¯•å„ JIT åç«¯ï¼ˆcraneliftï¼‰
- [ ] æµ‹è¯•ä¼˜åŒ–ç‰¹æ€§ï¼ˆsimd, tlb-cacheï¼‰

**æµ‹è¯•è„šæœ¬**ï¼š
```bash
#!/bin/bash
set -e

echo "=== Testing feature combinations ==="

# Test default
echo "Testing default..."
cargo build --workspace --all-features
cargo test --workspace --all-features

# Test async
echo "Testing async..."
cargo build --workspace --features async
cargo test --workspace --features async

# Test platforms
echo "Testing platforms..."
cargo build --workspace --features kvm
cargo build --workspace --features hvf
cargo build --workspace --features whp

echo "=== All tests passed ==="
```

### æˆåŠŸæ ‡å‡†

- [ ] ç‰¹æ€§ä½¿ç”¨ä» 72 å‡å°‘åˆ° ~30
- [ ] æ¨¡ç³Šç‰¹æ€§ï¼ˆperformance, optimizationsï¼‰å·²ç§»é™¤
- [ ] ç‰¹æ€§åç§°æ¸…æ™°æ˜ç¡®
- [ ] æ‰€æœ‰ç‰¹æ€§ç»„åˆæµ‹è¯•é€šè¿‡

---

## é˜¶æ®µ 6ï¼šæµ‹è¯•è¦†ç›–ç‡æå‡è®¡åˆ’

### ç›®æ ‡
æé«˜æµ‹è¯•è¦†ç›–ç‡åˆ° 70%+

### ä¼˜å…ˆçº§
ğŸŸ¢ **P2 - ä¸­ä¼˜å…ˆçº§**ï¼ˆå½±å“ä»£ç è´¨é‡ï¼‰

### æ—¶é—´ä¼°ç®—
1-2 å‘¨

### å®æ–½æ­¥éª¤

#### æ­¥éª¤ 1ï¼šé…ç½®è¦†ç›–ç‡å·¥å…·ï¼ˆ1 å¤©ï¼‰

**å·¥å…·é€‰æ‹©**ï¼štarpaulinï¼ˆæ¨èï¼‰æˆ– cargo-llvm-cov

**å®‰è£…**ï¼š
```bash
# å®‰è£… tarpaulin
cargo install cargo-tarpaulin

# æˆ–ä½¿ç”¨ cargo-llvm-cov
cargo install cargo-llvm-cov
```

**é…ç½®**ï¼š
```toml
# .cargo/config.toml
[target.x86_64-unknown-linux-gnu]
rustflags = ["-C", "link-arg=-fuse-ld=lld"]

[profile.dev]
opt-level = 0
```

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] å®‰è£…è¦†ç›–ç‡å·¥å…·
- [ ] é…ç½®æ„å»ºç¯å¢ƒ
- [ ] éªŒè¯å·¥å…·å¯è¿è¡Œ

#### æ­¥éª¤ 2ï¼šç”Ÿæˆè¦†ç›–ç‡åŸºçº¿ï¼ˆ1 å¤©ï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] è¿è¡Œå®Œæ•´è¦†ç›–ç‡æµ‹è¯•
- [ ] ç”Ÿæˆ HTML æŠ¥å‘Š
- [ ] åˆ†æå½“å‰è¦†ç›–ç‡
- [ ] è¯†åˆ«è¦†ç›–ç‡ä½çš„æ¨¡å—

**å‘½ä»¤**ï¼š
```bash
# è¿è¡Œè¦†ç›–ç‡æµ‹è¯•
cargo tarpaulin --workspace --all-features --out Html --output-dir coverage/

# æˆ–ä½¿ç”¨ cargo-llvm-cov
cargo llvm-cov --workspace --all-features --html
```

**è¦†ç›–ç‡ç›®æ ‡**ï¼š
- æ ¸å¿ƒæ¨¡å—ï¼ˆvm-core, vm-execution, vm-memï¼‰ï¼š80%+
- è®¾å¤‡æ¨¡å—ï¼ˆvm-devices, vm-accelï¼‰ï¼š70%+
- è¾…åŠ©æ¨¡å—ï¼ˆvm-optimizers, vm-serviceï¼‰ï¼š60%+

#### æ­¥éª¤ 3ï¼šæ·»åŠ å•å…ƒæµ‹è¯•ï¼ˆ3-5 å¤©ï¼‰

**ç­–ç•¥**ï¼š

| æ¨¡å— | å½“å‰è¦†ç›–ç‡ | ç›®æ ‡ | ç­–ç•¥ |
|------|-----------|------|------|
| vm-core | æœªçŸ¥ | 80%+ | æ ¸å¿ƒè·¯å¾„ 100% è¦†ç›– |
| vm-execution | æœªçŸ¥ | 80%+ | JIT è·¯å¾„å…¨é¢è¦†ç›– |
| vm-mem | æœªçŸ¥ | 80%+ | MMU/TLB å…¨é¢è¦†ç›– |
| vm-devices | æœªçŸ¥ | 70%+ | è®¾å¤‡æ¥å£è¦†ç›– |
| vm-accel | æœªçŸ¥ | 70%+ | ç¡¬ä»¶åŠ é€Ÿè¦†ç›– |

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] vm-coreï¼šæ·»åŠ  20-30 ä¸ªå•å…ƒæµ‹è¯•
- [ ] vm-executionï¼šæ·»åŠ  15-20 ä¸ªå•å…ƒæµ‹è¯•
- [ ] vm-memï¼šæ·»åŠ  25-30 ä¸ªå•å…ƒæµ‹è¯•
- [ ] vm-devicesï¼šæ·»åŠ  15-20 ä¸ªå•å…ƒæµ‹è¯•
- [ ] vm-accelï¼šæ·»åŠ  10-15 ä¸ªå•å…ƒæµ‹è¯•

#### æ­¥éª¤ 4ï¼šæ·»åŠ é›†æˆæµ‹è¯•ï¼ˆ2-3 å¤©ï¼‰

**æµ‹è¯•åœºæ™¯**ï¼š

1. **VM å¯åŠ¨æµ‹è¯•**
```rust
// tests/integration/vm_boot_test.rs
#[test]
fn test_vm_boot_x86_64() {
    let vm = create_vm(GuestArch::X86_64);
    vm.load_kernel("fixtures/linux-vmlinux");
    assert!(vm.boot().is_ok());
    assert!(vm.is_running());
}
```

2. **è·¨æ¶æ„ç¿»è¯‘æµ‹è¯•**
```rust
// tests/integration/cross_arch_test.rs
#[test]
fn test_cross_arch_x86_to_arm() {
    let vm = create_vm(GuestArch::X86_64, HostArch::ARM64);
    let result = vm.translate_and_execute_test_program();
    assert!(result.is_ok());
    assert_eq!(result.unwrap(), expected_value);
}
```

3. **è®¾å¤‡äº¤äº’æµ‹è¯•**
```rust
// tests/integration/device_test.rs
#[test]
fn test_device_hotplug() {
    let vm = create_vm();
    vm.add_device(Device::Network);
    vm.hotplug_device(0);
    assert!(vm.device_count() == 1);
}
```

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] æ·»åŠ  VM å¯åŠ¨æµ‹è¯•ï¼ˆ3-5 ä¸ªï¼‰
- [ ] æ·»åŠ è·¨æ¶æ„ç¿»è¯‘æµ‹è¯•ï¼ˆ5-8 ä¸ªï¼‰
- [ ] æ·»åŠ è®¾å¤‡äº¤äº’æµ‹è¯•ï¼ˆ3-5 ä¸ªï¼‰
- [ ] æ·»åŠ å†…å­˜ç®¡ç†æµ‹è¯•ï¼ˆ5-8 ä¸ªï¼‰
- [ ] æ·»åŠ  JIT æ‰§è¡Œæµ‹è¯•ï¼ˆ5-8 ä¸ªï¼‰

#### æ­¥éª¤ 5ï¼šæ·»åŠ ç«¯åˆ°ç«¯æµ‹è¯•ï¼ˆ2-3 å¤©ï¼‰

**æµ‹è¯•åœºæ™¯**ï¼š

1. **å®Œæ•´ OS å¯åŠ¨**
2. **å·¥ä½œè´Ÿè½½æ‰§è¡Œ**
3. **å¿«ç…§ä¿å­˜/æ¢å¤**
4. **è®¾å¤‡çƒ­æ’æ‹”**

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] OS å¯åŠ¨æµ‹è¯•ï¼ˆ2-3 ä¸ªï¼‰
- [ ] å·¥ä½œè´Ÿè½½æµ‹è¯•ï¼ˆ2-3 ä¸ªï¼‰
- [ ] å¿«ç…§æµ‹è¯•ï¼ˆ1-2 ä¸ªï¼‰
- [ ] çƒ­æ’æ‹”æµ‹è¯•ï¼ˆ1-2 ä¸ªï¼‰

#### æ­¥éª¤ 6ï¼šè¦†ç›–ç‡éªŒè¯å’Œä¼˜åŒ–ï¼ˆ1 å¤©ï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
- [ ] å¯¹æ¯”è¦†ç›–ç‡åŸºçº¿
- [ ] è¯†åˆ«è¦†ç›–ç‡ä½çš„åŒºåŸŸ
- [ ] æ·»åŠ è¡¥å……æµ‹è¯•
- [ ] è¾¾æˆè¦†ç›–ç‡ç›®æ ‡

**æœ€ç»ˆéªŒè¯**ï¼š
```bash
# è¿è¡Œæœ€ç»ˆè¦†ç›–ç‡æµ‹è¯•
cargo tarpaulin --workspace --all-features --out Html --output-dir coverage/

# æ£€æŸ¥è¦†ç›–ç‡
open coverage/index.html
```

### æˆåŠŸæ ‡å‡†

- [ ] æ ¸å¿ƒæ¨¡å—è¦†ç›–ç‡ï¼š80%+
- [ ] è®¾å¤‡æ¨¡å—è¦†ç›–ç‡ï¼š70%+
- [ ] é›†æˆæµ‹è¯•è¦†ç›–ä¸»è¦åœºæ™¯
- [ ] ç«¯åˆ°ç«¯æµ‹è¯•è¦†ç›–æ ¸å¿ƒåŠŸèƒ½

---

## é˜¶æ®µ 7ï¼šæœ€ç»ˆéªŒè¯è®¡åˆ’

### ç›®æ ‡
ç¡®ä¿é›¶é”™è¯¯ã€é›¶è­¦å‘Šã€æ‰€æœ‰æµ‹è¯•é€šè¿‡

### ä¼˜å…ˆçº§
ğŸ”´ **P0 - é«˜ä¼˜å…ˆçº§**ï¼ˆæœ€ç»ˆéªŒè¯ï¼‰

### æ—¶é—´ä¼°ç®—
1 å‘¨

### å®æ–½æ­¥éª¤

#### æ­¥éª¤ 1ï¼šä»£ç è´¨é‡éªŒè¯ï¼ˆ1 å¤©ï¼‰

**éªŒè¯å‘½ä»¤**ï¼š
```bash
#!/bin/bash
set -e

echo "=== ä»£ç è´¨é‡éªŒè¯ ==="

# 1. æ„å»ºæ£€æŸ¥
echo "1. æ„å»ºæ£€æŸ¥..."
cargo build --workspace --all-features 2>&1 | tee build.log
if [ $? -ne 0 ]; then
    echo "âŒ æ„å»ºå¤±è´¥"
    exit 1
fi
echo "âœ… æ„å»ºæˆåŠŸ"

# 2. Clippy æ£€æŸ¥
echo "2. Clippy æ£€æŸ¥..."
cargo clippy --workspace --all-features -- -D warnings 2>&1 | tee clippy.log
if [ ${PIPESTATUS[0]} -ne 0 ]; then
    echo "âŒ Clippy æ£€æŸ¥å¤±è´¥"
    exit 1
fi
echo "âœ… Clippy æ£€æŸ¥é€šè¿‡"

# 3. æ ¼å¼æ£€æŸ¥
echo "3. æ ¼å¼æ£€æŸ¥..."
cargo fmt --check --all 2>&1 | tee fmt.log
if [ $? -ne 0 ]; then
    echo "âŒ æ ¼å¼æ£€æŸ¥å¤±è´¥"
    exit 1
fi
echo "âœ… æ ¼å¼æ£€æŸ¥é€šè¿‡"

echo "=== ä»£ç è´¨é‡éªŒè¯å®Œæˆ ==="
```

**éªŒè¯æ ‡å‡†**ï¼š
- [ ] æ„å»ºæˆåŠŸï¼ˆé›¶é”™è¯¯ï¼‰
- [ ] Clippy é›¶è­¦å‘Š
- [ ] æ ¼å¼æ£€æŸ¥é€šè¿‡

#### æ­¥éª¤ 2ï¼šæµ‹è¯•å¥—ä»¶éªŒè¯ï¼ˆ1 å¤©ï¼‰

**éªŒè¯å‘½ä»¤**ï¼š
```bash
#!/bin/bash
set -e

echo "=== æµ‹è¯•å¥—ä»¶éªŒè¯ ==="

# 1. å•å…ƒæµ‹è¯•
echo "1. å•å…ƒæµ‹è¯•..."
cargo test --workspace --lib 2>&1 | tee unit-test.log

# 2. é›†æˆæµ‹è¯•
echo "2. é›†æˆæµ‹è¯•..."
cargo test --workspace --test integration 2>&1 | tee integration-test.log

# 3. æ‰€æœ‰æµ‹è¯•
echo "3. æ‰€æœ‰æµ‹è¯•..."
cargo test --workspace --all-features 2>&1 | tee test.log
if [ $? -ne 0 ]; then
    echo "âŒ æµ‹è¯•å¤±è´¥"
    exit 1
fi
echo "âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡"

echo "=== æµ‹è¯•å¥—ä»¶éªŒè¯å®Œæˆ ==="
```

**éªŒè¯æ ‡å‡†**ï¼š
- [ ] æ‰€æœ‰å•å…ƒæµ‹è¯•é€šè¿‡
- [ ] æ‰€æœ‰é›†æˆæµ‹è¯•é€šè¿‡
- [ ] æ— æµ‹è¯•å¤±è´¥

#### æ­¥éª¤ 3ï¼šè¦†ç›–ç‡éªŒè¯ï¼ˆåŠå¤©ï¼‰

**éªŒè¯å‘½ä»¤**ï¼š
```bash
echo "=== è¦†ç›–ç‡éªŒè¯ ==="

cargo tarpaulin --workspace --all-features --out Html --output-dir coverage/

# æ£€æŸ¥è¦†ç›–ç‡
if [ ! -f coverage/index.html ]; then
    echo "âŒ è¦†ç›–ç‡æŠ¥å‘Šæœªç”Ÿæˆ"
    exit 1
fi

echo "âœ… è¦†ç›–ç‡æŠ¥å‘Šå·²ç”Ÿæˆ"
echo "æ‰“å¼€æŠ¥å‘Š..."
open coverage/index.html
```

**éªŒè¯æ ‡å‡†**ï¼š
- [ ] æ ¸å¿ƒæ¨¡å—è¦†ç›–ç‡ â‰¥ 80%
- [ ] è®¾å¤‡æ¨¡å—è¦†ç›–ç‡ â‰¥ 70%
- [ ] æ•´ä½“è¦†ç›–ç‡ â‰¥ 70%

#### æ­¥éª¤ 4ï¼šæ€§èƒ½åŸºå‡†æµ‹è¯•ï¼ˆåŠå¤©ï¼‰

**éªŒè¯å‘½ä»¤**ï¼š
```bash
echo "=== æ€§èƒ½åŸºå‡†æµ‹è¯• ==="

cargo bench --workspace --all-features 2>&1 | tee bench.log

if [ $? -ne 0 ]; then
    echo "âŒ åŸºå‡†æµ‹è¯•å¤±è´¥"
    exit 1
fi

echo "âœ… åŸºå‡†æµ‹è¯•å®Œæˆ"
```

**éªŒè¯æ ‡å‡†**ï¼š
- [ ] æ‰€æœ‰åŸºå‡†æµ‹è¯•å¯è¿è¡Œ
- [ ] æ— æ€§èƒ½å›å½’ï¼ˆ<2%ï¼‰
- [ ] JIT æ€§èƒ½æå‡ 5-10%ï¼ˆCranelift å‡çº§ï¼‰

#### æ­¥éª¤ 5ï¼šæ–‡æ¡£éªŒè¯ï¼ˆåŠå¤©ï¼‰

**éªŒè¯å‘½ä»¤**ï¼š
```bash
echo "=== æ–‡æ¡£éªŒè¯ ==="

cargo doc --workspace --no-deps 2>&1 | tee doc.log

if [ $? -ne 0 ]; then
    echo "âŒ æ–‡æ¡£ç”Ÿæˆå¤±è´¥"
    exit 1
fi

echo "âœ… æ–‡æ¡£ç”ŸæˆæˆåŠŸ"
echo "æ‰“å¼€æ–‡æ¡£..."
open target/doc/vm/index.html
```

**éªŒè¯æ ‡å‡†**ï¼š
- [ ] æ–‡æ¡£ç”ŸæˆæˆåŠŸ
- [ ] æ— æ–‡æ¡£è­¦å‘Š
- [ ] æ‰€æœ‰å…¬å…± API æœ‰æ–‡æ¡£

#### æ­¥éª¤ 6ï¼šè·¨å¹³å°éªŒè¯ï¼ˆ1 å¤©ï¼‰

**éªŒè¯å¹³å°**ï¼š
- x86_64 Linux
- ARM64 Linux
- ARM64 macOS
- x86_64 Windows
- RISC-V64ï¼ˆå¦‚æ”¯æŒï¼‰

**ä»»åŠ¡æ¸…å•**ï¼š
- [ ] x86_64 Linuxï¼šæ„å»ºå’Œæµ‹è¯•
- [ ] ARM64 Linuxï¼šæ„å»ºå’Œæµ‹è¯•
- [ ] ARM64 macOSï¼šæ„å»ºå’Œæµ‹è¯•
- [ ] x86_64 Windowsï¼šæ„å»ºå’Œæµ‹è¯•
- [ ] RISC-V64ï¼šæ„å»ºå’Œæµ‹è¯•ï¼ˆå¦‚æ”¯æŒï¼‰

#### æ­¥éª¤ 7ï¼šç”Ÿæˆæœ€ç»ˆæŠ¥å‘Šï¼ˆåŠå¤©ï¼‰

**æŠ¥å‘Šå†…å®¹**ï¼š

1. **ä»£ç è´¨é‡æ‘˜è¦**
   - æ„å»ºçŠ¶æ€ï¼šæˆåŠŸ/å¤±è´¥
   - Clippy è­¦å‘Šæ•°ï¼š0
   - æ ¼å¼æ£€æŸ¥ï¼šé€šè¿‡
   - ä»£ç è¡Œæ•°ç»Ÿè®¡

2. **æµ‹è¯•è¦†ç›–ç‡æ‘˜è¦**
   - æ€»è¦†ç›–ç‡ï¼šXX%
   - æ ¸å¿ƒæ¨¡å—ï¼šXX%
   - è®¾å¤‡æ¨¡å—ï¼šXX%
   - æµ‹è¯•æ•°ï¼šXXX

3. **æ€§èƒ½æ‘˜è¦**
   - JIT ç¼–è¯‘é€Ÿåº¦ï¼šXXÎ¼s
   - å†…å­˜æ€§èƒ½ï¼šXX MB/s
   - æ‰§è¡Œé€Ÿåº¦ï¼šXX MIPS
   - æ€§èƒ½æå‡ï¼šXX%

4. **ç°ä»£åŒ–æ‘˜è¦**
   - Cranelift ç‰ˆæœ¬ï¼š0.127.2
   - æ‰€æœ‰ä¾èµ–æœ€æ–°
   - Workspace membersï¼š20
   - ç‰¹æ€§ä½¿ç”¨ï¼š~30

**ç”ŸæˆæŠ¥å‘Š**ï¼š
```bash
# ç”Ÿæˆæœ€ç»ˆæŠ¥å‘Š
cat > FINAL_VERIFICATION_REPORT.md << 'EOF'
# æœ€ç»ˆéªŒè¯æŠ¥å‘Š

## æ‰§è¡Œæ‘˜è¦

æœ¬æŠ¥å‘Šè®°å½• Rust è™šæ‹Ÿæœºé¡¹ç›®ç°ä»£åŒ–å‡çº§åçš„æœ€ç»ˆéªŒè¯ç»“æœã€‚

## éªŒè¯ç»“æœ

### ä»£ç è´¨é‡
- æ„å»ºçŠ¶æ€ï¼šâœ… æˆåŠŸ
- Clippy è­¦å‘Šï¼š0
- æ ¼å¼æ£€æŸ¥ï¼šâœ… é€šè¿‡

### æµ‹è¯•è¦†ç›–ç‡
- æ€»è¦†ç›–ç‡ï¼šXX%
- æ ¸å¿ƒæ¨¡å—ï¼šXX%
- è®¾å¤‡æ¨¡å—ï¼šXX%

### æ€§èƒ½
- JIT ç¼–è¯‘é€Ÿåº¦ï¼šXXÎ¼s
- æ‰§è¡Œé€Ÿåº¦ï¼šXX MIPS
- æ€§èƒ½æå‡ï¼šXX%

### ç°ä»£åŒ–
- Cranelift ç‰ˆæœ¬ï¼š0.127.2
- æ‰€æœ‰ä¾èµ–ï¼šæœ€æ–°
- Workspace membersï¼š20
- ç‰¹æ€§ä½¿ç”¨ï¼š~30

## ç»“è®º

é¡¹ç›®å·²æˆåŠŸå®Œæˆç°ä»£åŒ–å‡çº§ï¼Œè¾¾åˆ°é›¶é”™è¯¯ã€é›¶è­¦å‘Šçš„ç›®æ ‡ã€‚
EOF
```

### æˆåŠŸæ ‡å‡†

- [ ] æ‰€æœ‰éªŒè¯é€šè¿‡
- [ ] æœ€ç»ˆæŠ¥å‘Šå·²ç”Ÿæˆ
- [ ] å¯ä»¥å‘å¸ƒ

---

## æ—¶é—´åˆ†é…æ€»ç»“

| é˜¶æ®µ | ä»»åŠ¡ | é¢„è®¡æ—¶é—´ |
|------|------|----------|
| **é˜¶æ®µ 0** | ç´§æ€¥ä¿®å¤ | 1-2 å¤© |
| **é˜¶æ®µ 1** | ä¾èµ–å‡çº§ | 1-2 å‘¨ |
| **é˜¶æ®µ 2** | ä»£ç è´¨é‡æ¸…ç† | 2-3 å‘¨ |
| **é˜¶æ®µ 3** | æ¨¡å—é‡æ„ | 2-3 å‘¨ |
| **é˜¶æ®µ 4** | æ¡ä»¶ç¼–è¯‘ç®€åŒ– | 1-2 å‘¨ |
| **é˜¶æ®µ 5** | æµ‹è¯•è¦†ç›–ç‡æå‡ | 1-2 å‘¨ |
| **é˜¶æ®µ 6** | æ–‡æ¡£å®Œå–„ | 1 å‘¨ |
| **é˜¶æ®µ 7** | æœ€ç»ˆéªŒè¯ | 1 å‘¨ |
| **æ€»è®¡** | - | **10-12 å‘¨** |

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼š1.0  
**åˆ›å»ºæ—¥æœŸ**ï¼š2026-01-20  
**çŠ¶æ€**ï¼šå¾…å¼€å§‹
