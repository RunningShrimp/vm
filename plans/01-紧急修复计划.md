# é˜¶æ®µ 0ï¼šç´§æ€¥ä¿®å¤è®¡åˆ’

## ç›®æ ‡
ä¿®å¤é˜»å¡æ€§æ„å»ºé”™è¯¯ï¼Œä½¿é¡¹ç›®å¯ç¼–è¯‘

## ä¼˜å…ˆçº§
ğŸ”´ **P0 - ç´§æ€¥**ï¼ˆé˜»å¡æ‰€æœ‰å¼€å‘å·¥ä½œï¼‰

## æ—¶é—´ä¼°ç®—
1-2 å¤©

## é—®é¢˜æ¦‚è¿°

### å½“å‰é”™è¯¯
```
error: failed to load manifest for workspace member `/Users/wangbiao/Desktop/project/vm/crates/core/vm-boot`
referenced by workspace at `/Users/wangbiao/Desktop/project/vm/Cargo.toml`

Caused by:
  failed to load manifest for dependency `vm-device`

Caused by:
  failed to load manifest for dependency `vm-passthrough`

Caused by:
  failed to load manifest for dependency `vm-build-deps`

Caused by:
  failed to read `/Users/wangbiao/Desktop/project/vm/tools/crates/architecture/vm-build-deps/Cargo.toml`
  No such file or directory (os error 2)
```

### æ ¹æœ¬åŸå› 
`vm-build-deps` çš„è·¯å¾„å¼•ç”¨é”™è¯¯ï¼š
- **å½“å‰å¼•ç”¨**ï¼š`../../architecture/vm-build-deps`
- **å®é™…ä½ç½®**ï¼š`../../architecture/vm-build-deps`ï¼ˆåº”åœ¨ `crates/` ä¸‹ï¼‰
- **é”™è¯¯è·¯å¾„**ï¼š`tools/crates/architecture/vm-build-deps`ï¼ˆä¸å­˜åœ¨ï¼‰

## å®æ–½æ­¥éª¤

### æ­¥éª¤ 1ï¼šå®šä½ vm-build-deps å®é™…ä½ç½®ï¼ˆ30 åˆ†é’Ÿï¼‰

**ä»»åŠ¡**ï¼š
- [ ] ä½¿ç”¨ find å‘½ä»¤æŸ¥æ‰¾ vm-build-deps ç›®å½•
- [ ] ç¡®è®¤å…¶æ­£ç¡®è·¯å¾„

**å‘½ä»¤**ï¼š
```bash
# æŸ¥æ‰¾ vm-build-deps ç›®å½•
find /Users/wangbiao/Desktop/project/vm -name "vm-build-deps" -type d

# é¢„æœŸè¾“å‡ºï¼š
# /Users/wangbiao/Desktop/project/vm/crates/architecture/vm-build-deps
```

**éªŒè¯æ ‡å‡†**ï¼š
- [ ] vm-build-deps ç›®å½•å·²å®šä½
- [ ] è·¯å¾„ç¡®è®¤æ­£ç¡®

### æ­¥éª¤ 2ï¼šéªŒè¯ vm-build-deps Cargo.tomlï¼ˆ15 åˆ†é’Ÿï¼‰

**ä»»åŠ¡**ï¼š
- [ ] æ£€æŸ¥ vm-build-deps çš„ Cargo.toml
- [ ] ç¡®è®¤å…¶ä¸ºæœ‰æ•ˆçš„ workspace æˆå‘˜

**å‘½ä»¤**ï¼š
```bash
# æ£€æŸ¥ Cargo.toml
cat /Users/wangbiao/Desktop/project/vm/crates/architecture/vm-build-deps/Cargo.toml
```

**éªŒè¯æ ‡å‡†**ï¼š
- [ ] Cargo.toml å­˜åœ¨ä¸”æœ‰æ•ˆ
- [ ] åŒ…åå’Œç‰ˆæœ¬æ­£ç¡®

### æ­¥éª¤ 3ï¼šè¯†åˆ«æ‰€æœ‰å¼•ç”¨ vm-build-deps çš„æ–‡ä»¶ï¼ˆ30 åˆ†é’Ÿï¼‰

**ä»»åŠ¡**ï¼š
- [ ] æœç´¢æ‰€æœ‰å¼•ç”¨ `vm-build-deps` çš„ Cargo.toml
- [ ] åˆ—å‡ºéœ€è¦æ›´æ–°çš„æ–‡ä»¶

**å‘½ä»¤**ï¼š
```bash
# æœç´¢æ‰€æœ‰å¼•ç”¨ vm-build-deps çš„æ–‡ä»¶
grep -r "vm-build-deps" --include="Cargo.toml" .
```

**é¢„æœŸè¾“å‡º**ï¼š
- `crates/execution/vm-engine-jit/Cargo.toml`
- `crates/execution/vm-engine/Cargo.toml`
- `crates/memory/vm-mem/Cargo.toml`
- `crates/core/vm-core/Cargo.toml`
- `crates/core/vm-ir/Cargo.toml`
- å…¶ä»–...

**éªŒè¯æ ‡å‡†**ï¼š
- [ ] æ‰€æœ‰å¼•ç”¨æ–‡ä»¶å·²åˆ—å‡º
- [ ] å½±å“èŒƒå›´å·²æ˜ç¡®

### æ­¥éª¤ 4ï¼šæ›´æ–°æ‰€æœ‰ Cargo.toml è·¯å¾„å¼•ç”¨ï¼ˆ2-3 å°æ—¶ï¼‰

**ä»»åŠ¡**ï¼š
- [ ] æ›´æ–°æ‰€æœ‰é”™è¯¯çš„ `vm-build-deps` è·¯å¾„å¼•ç”¨
- [ ] éªŒè¯è·¯å¾„æ­£ç¡®æ€§

**æ›´æ–°è§„åˆ™**ï¼š

#### è§„åˆ™ Aï¼šåœ¨ crates/ ä¸‹çš„ crate
```toml
# ä¿®æ”¹å‰ï¼ˆé”™è¯¯ï¼‰
vm-build-deps = { path = "../../architecture/vm-build-deps" }

# ä¿®æ”¹åï¼ˆæ­£ç¡®ï¼‰
vm-build-deps = { path = "../vm-build-deps" }
# æˆ–
vm-build-deps = { path = "../../architecture/vm-build-deps" }  # å¦‚æœåœ¨ crates/ æ ¹ç›®å½•
```

#### è§„åˆ™ Bï¼šåœ¨ crates/execution/ ä¸‹çš„ crate
```toml
# ä¿®æ”¹å‰ï¼ˆé”™è¯¯ï¼‰
vm-build-deps = { path = "../../architecture/vm-build-deps" }

# ä¿®æ”¹åï¼ˆæ­£ç¡®ï¼‰
vm-build-deps = { path = "../../architecture/vm-build-deps" }
```

#### è§„åˆ™ Cï¼šåœ¨ crates/memory/ ä¸‹çš„ crate
```toml
# ä¿®æ”¹å‰ï¼ˆé”™è¯¯ï¼‰
vm-build-deps = { path = "../../architecture/vm-build-deps" }

# ä¿®æ”¹åï¼ˆæ­£ç¡®ï¼‰
vm-build-deps = { path = "../../architecture/vm-build-deps" }
```

**éœ€è¦æ›´æ–°çš„æ–‡ä»¶åˆ—è¡¨**ï¼ˆæ ¹æ®æœç´¢ç»“æœï¼‰ï¼š

| æ–‡ä»¶ | è·¯å¾„ | æ–°è·¯å¾„ |
|------|------|--------|
| vm-engine-jit | crates/execution/vm-engine-jit/Cargo.toml | `../../architecture/vm-build-deps"` |
| vm-engine | crates/execution/vm-engine/Cargo.toml | `../../architecture/vm-build-deps"` |
| vm-mem | crates/memory/vm-mem/Cargo.toml | `../../architecture/vm-build-deps"` |
| vm-core | crates/core/vm-core/Cargo.toml | `../../architecture/vm-build-deps"` |
| vm-ir | crates/core/vm-ir/Cargo.toml | `../../architecture/vm-build-deps"` |
| ... | ... | ... |

**éªŒè¯æ ‡å‡†**ï¼š
- [ ] æ‰€æœ‰æ–‡ä»¶å·²æ›´æ–°
- [ ] è·¯å¾„å¼•ç”¨æ­£ç¡®
- [ ] è¯­æ³•æ­£ç¡®ï¼ˆæ— é”™è¯¯ï¼‰

### æ­¥éª¤ 5ï¼šéªŒè¯ workspace æˆå‘˜åˆ—è¡¨ï¼ˆ30 åˆ†é’Ÿï¼‰

**ä»»åŠ¡**ï¼š
- [ ] æ£€æŸ¥æ ¹ Cargo.toml çš„ workspace æˆå‘˜åˆ—è¡¨
- [ ] ç¡®è®¤æ‰€æœ‰æˆå‘˜è·¯å¾„æ­£ç¡®

**æ£€æŸ¥é¡¹**ï¼š
```toml
[workspace]
members = [
    "crates/core/vm-core",
    "crates/core/vm-ir",
    "crates/core/vm-boot",
    "crates/execution/vm-engine",
    "crates/execution/vm-engine-jit",
    "crates/execution/vm-frontend",
    "crates/memory/vm-mem",
    "crates/memory/vm-gc",
    "crates/memory/vm-optimizers",
    "crates/platform/vm-accel",
    "crates/platform/vm-platform",
    "crates/platform/vm-osal",
    "crates/devices/vm-device",
    "crates/devices/vm-graphics",
    "crates/devices/vm-smmu",
    "crates/devices/vm-soc",
    "crates/runtime/vm-service",
    "crates/runtime/vm-plugin",
    "crates/runtime/vm-monitor",
    "crates/compatibility/security-sandbox",
    "crates/compatibility/syscall-compat",
    "crates/architecture/vm-cross-arch-support",
    "crates/architecture/vm-codegen",
    "crates/architecture/vm-build-deps",  # ç¡®è®¤æ­¤è¡Œå­˜åœ¨
    "tools/cli",
    "tools/desktop",
    "tools/debug",
    "tools/passthrough",
    "research/perf-bench",
    "research/tiered-compiler",
    "research/parallel-jit",
    "research/benches",
]
```

**éªŒè¯æ ‡å‡†**ï¼š
- [ ] workspace æˆå‘˜åˆ—è¡¨æ­£ç¡®
- [ ] æ‰€æœ‰æˆå‘˜è·¯å¾„å­˜åœ¨

### æ­¥éª¤ 6ï¼šæ¸…ç† Cargo.lockï¼ˆ15 åˆ†é’Ÿï¼‰

**ä»»åŠ¡**ï¼š
- [ ] åˆ é™¤ç°æœ‰çš„ Cargo.lock
- [ ] é‡æ–°ç”Ÿæˆé”æ–‡ä»¶

**å‘½ä»¤**ï¼š
```bash
# åˆ é™¤ Cargo.lock
rm Cargo.lock

# é‡æ–°ç”Ÿæˆé”æ–‡ä»¶
cargo generate-lockfile
# æˆ–
cargo check
```

**éªŒè¯æ ‡å‡†**ï¼š
- [ ] Cargo.lock å·²æ¸…ç†
- [ ] æ–°é”æ–‡ä»¶å·²ç”Ÿæˆ

### æ­¥éª¤ 7ï¼šæ„å»ºéªŒè¯ï¼ˆ1-2 å°æ—¶ï¼‰

**ä»»åŠ¡**ï¼š
- [ ] å°è¯•æ„å»ºæ•´ä¸ª workspace
- [ ] æ£€æŸ¥æ˜¯å¦æœ‰å…¶ä»–æ„å»ºé”™è¯¯

**å‘½ä»¤**ï¼š
```bash
# æ„å»ºæ•´ä¸ª workspace
cargo build --workspace

# å¦‚æœæˆåŠŸï¼Œæµ‹è¯•æ„å»º
cargo build --workspace --all-features

# æ£€æŸ¥ clippyï¼ˆå¯é€‰ï¼Œä½†å¯èƒ½å› å…¶ä»–é—®é¢˜å¤±è´¥ï¼‰
cargo clippy --workspace --allow-dirty
```

**éªŒè¯æ ‡å‡†**ï¼š
- [ ] `cargo build --workspace` æˆåŠŸï¼ˆé›¶é”™è¯¯ï¼‰
- [ ] æ‰€æœ‰ workspace æˆå‘˜å¯æ„å»º
- [ ] æ— æ–°çš„æ„å»ºé”™è¯¯

### æ­¥éª¤ 8ï¼šè¿è¡Œæµ‹è¯•ï¼ˆ1 å°æ—¶ï¼‰

**ä»»åŠ¡**ï¼š
- [ ] è¿è¡ŒåŸºæœ¬æµ‹è¯•å¥—ä»¶
- [ ] éªŒè¯åŠŸèƒ½æœªå—å½±å“

**å‘½ä»¤**ï¼š
```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
cargo test --workspace

# å¦‚æœå¤±è´¥ï¼Œè¿è¡Œç‰¹å®š crate æµ‹è¯•
cargo test -p vm-core
cargo test -p vm-engine
# ...
```

**éªŒè¯æ ‡å‡†**ï¼š
- [ ] æµ‹è¯•å¯è¿è¡Œ
- [ ] æ ¸å¿ƒåŠŸèƒ½æµ‹è¯•é€šè¿‡

## æˆåŠŸæ ‡å‡†

### é˜¶æ®µå®Œæˆæ ‡å‡†
- [ ] âœ… `cargo build --workspace` æˆåŠŸï¼ˆé›¶é”™è¯¯ï¼‰
- [ ] âœ… æ‰€æœ‰ workspace æˆå‘˜å¯æ„å»º
- [ ] âœ… `cargo build --workspace --all-features` æˆåŠŸ
- [ ] âœ… åŸºæœ¬æµ‹è¯•å¥—ä»¶å¯è¿è¡Œ

### è´¨é‡æ ‡å‡†
- [ ] âœ… æ— æ–°å¢æŠ€æœ¯å€ºåŠ¡
- [ ] âœ… æ‰€æœ‰ä¿®æ”¹å·²æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶
- [ ] âœ… æ„å»ºæ—¶é—´ <10 åˆ†é’Ÿ

## å›æ»šè®¡åˆ’

å¦‚æœä¿®å¤åä»æ— æ³•æ„å»ºï¼š

### å›æ»šæ­¥éª¤ 1ï¼šæ¢å¤åŸå§‹ Cargo.toml
```bash
# ä½¿ç”¨ git æ¢å¤
git checkout HEAD -- **/Cargo.toml
```

### å›æ»šæ­¥éª¤ 2ï¼šå¯»æ±‚æ›¿ä»£æ–¹æ¡ˆ
- [ ] è€ƒè™‘ç§»é™¤ vm-build-deps ä¾èµ–
- [ ] ç›´æ¥ä½¿ç”¨ workspace ä¾èµ–
- [ ] é‡æ–°ç»„ç»‡ crate ç»“æ„

## åç»­è¡ŒåŠ¨

é˜¶æ®µ 0 å®Œæˆåï¼š

### ç«‹å³è¡ŒåŠ¨
- [ ] æäº¤ä¿®å¤åˆ°ç‰ˆæœ¬æ§åˆ¶
- [ ] åˆ›å»º PR ä¾›ä»£ç å®¡æŸ¥
- [ ] é€šçŸ¥å›¢é˜Ÿé¡¹ç›®å¯æ„å»º

### è¿›å…¥é˜¶æ®µ 1
- [ ] å¼€å§‹ä¾èµ–å‡çº§è®¡åˆ’
- [ ] æ‰§è¡Œé˜¶æ®µ 1ï¼šä¾èµ–å‡çº§

## é£é™©ä¸ç¼“è§£

| é£é™© | æ¦‚ç‡ | å½±å“ | ç¼“è§£æªæ–½ |
|------|------|------|----------|
| è·¯å¾„ä¿®å¤å¼•å…¥æ–°é”™è¯¯ | ä½ | ä¸­ | å……åˆ†æµ‹è¯•æ¯ä¸ª crate çš„æ„å»º |
| ä¾èµ–å…³ç³»å¤æ‚å¯¼è‡´æ„å»ºé¡ºåºé—®é¢˜ | ä¸­ | ä¸­ | ä½¿ç”¨ cargo build --all-targets |
| æŸäº› crate æ— æ³•æ„å»º | ä½ | é«˜ | é€ä¸ªæ„å»ºï¼Œå®šä½é—®é¢˜ |
| Cargo.lock å†²çª | ä½ | ä½ | åˆ é™¤å¹¶é‡æ–°ç”Ÿæˆ |

## æ—¶é—´åˆ†é…

| ä»»åŠ¡ | é¢„è®¡æ—¶é—´ | å®é™…æ—¶é—´ | çŠ¶æ€ |
|------|----------|----------|------|
| æ­¥éª¤ 1ï¼šå®šä½ vm-build-deps | 30 åˆ†é’Ÿ | | â˜ |
| æ­¥éª¤ 2ï¼šéªŒè¯ Cargo.toml | 15 åˆ†é’Ÿ | | â˜ |
| æ­¥éª¤ 3ï¼šè¯†åˆ«å¼•ç”¨æ–‡ä»¶ | 30 åˆ†é’Ÿ | | â˜ |
| æ­¥éª¤ 4ï¼šæ›´æ–°è·¯å¾„å¼•ç”¨ | 2-3 å°æ—¶ | | â˜ |
| æ­¥éª¤ 5ï¼šéªŒè¯ workspace åˆ—è¡¨ | 30 åˆ†é’Ÿ | | â˜ |
| æ­¥éª¤ 6ï¼šæ¸…ç† Cargo.lock | 15 åˆ†é’Ÿ | | â˜ |
| æ­¥éª¤ 7ï¼šæ„å»ºéªŒè¯ | 1-2 å°æ—¶ | | â˜ |
| æ­¥éª¤ 8ï¼šè¿è¡Œæµ‹è¯• | 1 å°æ—¶ | | â˜ |
| **æ€»è®¡** | **6-8 å°æ—¶** | | **è¿›è¡Œä¸­** |

## é™„å½•

### A. ç›¸å…³æ–‡ä»¶
- Cargo.tomlï¼ˆæ ¹ç›®å½•ï¼‰
- crates/*/Cargo.tomlï¼ˆæ‰€æœ‰ crateï¼‰
- Cargo.lock

### B. å‚è€ƒèµ„æ–™
- [Cargo Workspace Documentation](https://doc.rust-lang.org/cargo/reference/workspaces.html)
- [Cargo.toml Format](https://doc.rust-lang.org/cargo/reference/manifest.html)
- [Path Dependencies](https://doc.rust-lang.org/cargo/reference/specifying-dependencies.html#specifying-path-dependencies)

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼š1.0  
**åˆ›å»ºæ—¥æœŸ**ï¼š2026-01-20  
**è´Ÿè´£äºº**ï¼šå¾…åˆ†é…  
**çŠ¶æ€**ï¼šå¾…å¼€å§‹
