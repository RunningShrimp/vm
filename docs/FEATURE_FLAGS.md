# VMé¡¹ç›®ç‰¹æ€§æ ‡å¿—æ–‡æ¡£

**ç”Ÿæˆæ—¥æœŸ**: 2026-01-06
**ç‰ˆæœ¬**: 1.0
**çŠ¶æ€**: Round 43

---

## ğŸ“‹ æ¦‚è¿°

VMé¡¹ç›®ä½¿ç”¨ Cargo feature flags æ¥æ§åˆ¶æ¡ä»¶ç¼–è¯‘å’Œå¯é€‰ä¾èµ–ã€‚æœ¬æ–‡æ¡£åˆ—å‡ºäº†æ‰€æœ‰ä¸»è¦ crate çš„ç‰¹æ€§æ ‡å¿—ã€ç”¨é€”ã€ä¾èµ–å…³ç³»å’Œä½¿ç”¨åœºæ™¯ã€‚

---

## ğŸ¯ ç‰¹æ€§æ ‡å¿—åˆ†ç±»

1. **å¹³å°ç‰¹æ€§** - æ¶æ„ç›¸å…³
2. **ä¼˜åŒ–ç‰¹æ€§** - æ€§èƒ½ä¼˜åŒ–
3. **åŠŸèƒ½ç‰¹æ€§** - åŠŸèƒ½æ¨¡å—
4. **å¼€å‘ç‰¹æ€§** - æµ‹è¯•å’Œè°ƒè¯•

---

## vm-core ç‰¹æ€§

### é»˜è®¤ç‰¹æ€§
```toml
default = ["std"]
```

### åŠŸèƒ½ç‰¹æ€§

#### `std`
- **ç±»å‹**: åŠŸèƒ½ç‰¹æ€§
- **æè¿°**: å¯ç”¨æ ‡å‡†åº“ä¾èµ–
- **ç”¨é€”**: å¤§å¤šæ•°ç¯å¢ƒä¸‹çš„é»˜è®¤é…ç½®
- **ä¾èµ–**: æ— 
- **æ€§èƒ½å½±å“**: æ— 
- **ä½¿ç”¨åœºæ™¯**:
  - âœ… é»˜è®¤ä½¿ç”¨
  - âœ… ä¸»æœºç¯å¢ƒ
  - âŒ åµŒå…¥å¼ç¯å¢ƒ(è€ƒè™‘ `no_std`)

#### `async`
- **ç±»å‹**: åŠŸèƒ½ç‰¹æ€§
- **æè¿°**: å¯ç”¨å¼‚æ­¥æ”¯æŒ
- **ä¾èµ–**: `tokio`, `futures`, `async-trait`
- **æ€§èƒ½å½±å“**: è½»å¾®è¿è¡Œæ—¶å¼€é”€
- **ä½¿ç”¨åœºæ™¯**:
  - âœ… å¼‚æ­¥æ‰§è¡Œå¼•æ“
  - âœ… å¼‚æ­¥I/Oæ“ä½œ
  - âŒ åŒæ­¥ä¼˜å…ˆç¯å¢ƒ

#### `enhanced-event-sourcing`
- **ç±»å‹**: åŠŸèƒ½ç‰¹æ€§
- **æè¿°**: å¢å¼ºçš„äº‹ä»¶æº¯æºæ”¯æŒ
- **ä¾èµ–**: `chrono`, `tokio`
- **æ€§èƒ½å½±å“**: äº‹ä»¶åºåˆ—åŒ–å¼€é”€
- **ä½¿ç”¨åœºæ™¯**:
  - âœ… äº‹ä»¶æº¯æºæ¶æ„
  - âœ… CQRSæ¨¡å¼
  - âŒ ç®€å•æ‰§è¡Œæµç¨‹

### å¹³å°ç‰¹æ€§

#### `x86_64`
- **ç±»å‹**: å¹³å°ç‰¹æ€§
- **æè¿°**: AMD64/x86_64æ¶æ„æ”¯æŒ
- **ç”¨é€”**: æ¡ä»¶ç¼–è¯‘x86_64ç‰¹å®šä»£ç 
- **ä¾èµ–**: æ— 
- **æ€§èƒ½å½±å“**: æ— 
- **ä½¿ç”¨åœºæ™¯**:
  - âœ… Intel/AMD 64ä½å¤„ç†å™¨
  - âŒ ARMå¹³å°

#### `arm64`
- **ç±»å‹**: å¹³å°ç‰¹æ€§
- **æè¿°**: ARM64æ¶æ„æ”¯æŒ
- **ç”¨é€”**: æ¡ä»¶ç¼–è¯‘ARM64ç‰¹å®šä»£ç 
- **ä¾èµ–**: æ— 
- **æ€§èƒ½å½±å“**: æ— 
- **ä½¿ç”¨åœºæ™¯**:
  - âœ… Apple Silicon
  - âœ… ARMæœåŠ¡å™¨
  - âŒ x86å¹³å°

#### `riscv64`
- **ç±»å‹**: å¹³å°ç‰¹æ€§
- **æè¿°**: RISC-V 64ä½æ¶æ„æ”¯æŒ
- **ç”¨é€”**: æ¡ä»¶ç¼–è¯‘RISC-Vç‰¹å®šä»£ç 
- **ä¾èµ–**: æ— 
- **æ€§èƒ½å½±å“**: æ— 
- **ä½¿ç”¨åœºæ™¯**:
  - âœ… RISC-Vç¡¬ä»¶
  - âŒ x86/ARMå¹³å°

---

## vm-mem ç‰¹æ€§

### é»˜è®¤ç‰¹æ€§
```toml
default = ["std", "optimizations"]
```

### åŸºç¡€ç‰¹æ€§

#### `std`
- **ç±»å‹**: åŠŸèƒ½ç‰¹æ€§
- **æè¿°**: æ ‡å‡†åº“æ”¯æŒ
- **ä¾èµ–**: æ— 
- **ä½¿ç”¨åœºæ™¯**: é»˜è®¤å¯ç”¨

### ä¼˜åŒ–ç‰¹æ€§

#### `opt-simd` â­â­â­â­â­
- **ç±»å‹**: ä¼˜åŒ–ç‰¹æ€§
- **æè¿°**: SIMDä¼˜åŒ–(å‘é‡æŒ‡ä»¤)
- **ä¾èµ–**: æ— 
- **æ€§èƒ½å½±å“**: **2-4å€åŠ é€Ÿ**(å°å‘é‡)
- **ä½¿ç”¨åœºæ™¯**:
  - âœ… å‘é‡è¿ç®—
  - âœ… æ‰¹é‡æ•°æ®å¤„ç†
  - âœ… æ€§èƒ½æ•æ„Ÿåº”ç”¨
- **ç¤ºä¾‹**:
  ```bash
  cargo build --features opt-simd
  ```

#### `opt-tlb`
- **ç±»å‹**: ä¼˜åŒ–ç‰¹æ€§
- **æè¿°**: TLBä¼˜åŒ–
- **ä¾èµ–**: æ— 
- **æ€§èƒ½å½±å“**: å‡å°‘5-15%TLB miss
- **ä½¿ç”¨åœºæ™¯**:
  - âœ… å¤§å†…å­˜åº”ç”¨
  - âœ… è™šæ‹Ÿæœºå¯†é›†å·¥ä½œè´Ÿè½½
  - âŒ å°å†…å­˜åµŒå…¥å¼

#### `opt-numa`
- **ç±»å‹**: ä¼˜åŒ–ç‰¹æ€§
- **æè¿°**: NUMAä¼˜åŒ–
- **ä¾èµ–**: æ— 
- **æ€§èƒ½å½±å“**: å¤šèŠ‚ç‚¹æœåŠ¡å™¨10-20%æå‡
- **ä½¿ç”¨åœºæ™¯**:
  - âœ… å¤šè·¯æœåŠ¡å™¨
  - âœ… å¤§å‹VMå®ä¾‹
  - âŒ å•èŠ‚ç‚¹æœºå™¨

#### `opt-prefetch`
- **ç±»å‹**: ä¼˜åŒ–ç‰¹æ€§
- **æè¿°**: æ•°æ®é¢„å–ä¼˜åŒ–
- **ä¾èµ–**: æ— 
- **æ€§èƒ½å½±å“**: 5-10%ç¼“å­˜å‘½ä¸­ç‡æå‡
- **ä½¿ç”¨åœºæ™¯**:
  - âœ… è®¿é—®æ¨¡å¼å¯é¢„æµ‹
  - âœ… å¤§æ•°æ®é›†å¤„ç†

#### `opt-concurrent`
- **ç±»å‹**: ä¼˜åŒ–ç‰¹æ€§
- **æè¿°**: å¹¶å‘ä¼˜åŒ–
- **ä¾èµ–**: æ— 
- **æ€§èƒ½å½±å“**: å¤šçº¿ç¨‹5-15%æå‡
- **ä½¿ç”¨åœºæ™¯**:
  - âœ… å¤šæ ¸ç¯å¢ƒ
  - âœ… å¹¶å‘å·¥ä½œè´Ÿè½½

#### `optimizations` (ç»„åˆ)
- **ç±»å‹**: ç»„åˆç‰¹æ€§
- **æè¿°**: å¯ç”¨å¤šé¡¹ä¼˜åŒ–
- **ä¾èµ–**: `["opt-simd", "opt-tlb", "opt-numa"]`
- **æ€§èƒ½å½±å“**: ç»„åˆæ•ˆæœ
- **ä½¿ç”¨åœºæ™¯**:
  - âœ… é»˜è®¤é…ç½®
  - âœ… ç”Ÿäº§ç¯å¢ƒ

### åŠŸèƒ½ç‰¹æ€§

#### `async`
- **ç±»å‹**: åŠŸèƒ½ç‰¹æ€§
- **æè¿°**: å¼‚æ­¥å†…å­˜ç®¡ç†
- **ä¾èµ–**: `tokio`, `async-trait`
- **æ€§èƒ½å½±å“**: å¼‚æ­¥å¼€é”€
- **ä½¿ç”¨åœºæ™¯**:
  - âœ… å¼‚æ­¥æ‰§è¡Œå¼•æ“
  - âŒ åŒæ­¥ä¼˜å…ˆåœºæ™¯

### å·²å¼ƒç”¨ç‰¹æ€§

#### `tlb` (deprecated)
- **çŠ¶æ€**: å·²å¼ƒç”¨
- **æ›¿ä»£**: `opt-tlb`
- **ç§»é™¤ç‰ˆæœ¬**: æœªæ¥2-3ä¸ªç‰ˆæœ¬

---

## vm-engine-jit ç‰¹æ€§

(å¾…è¡¥å…… - éœ€è¦åˆ†ævm-engine-jit/Cargo.toml)

---

## vm-monitor ç‰¹æ€§

(å¾…è¡¥å…… - éœ€è¦åˆ†ævm-monitor/Cargo.toml)

---

## ğŸ“Š ç‰¹æ€§ç»„åˆå»ºè®®

### åœºæ™¯1: æœ€å¤§æ€§èƒ½
```toml
[dependencies]
vm-core = { features = ["std", "async"], version = "0.1" }
vm-mem = { features = ["std", "opt-simd", "opt-tlb", "opt-numa", "opt-prefetch", "opt-concurrent"], version = "0.1" }
```

**é¢„æœŸæå‡**: 20-50% (å–å†³äºå·¥ä½œè´Ÿè½½)

---

### åœºæ™¯2: åµŒå…¥å¼/å°å†…å­˜
```toml
vm-core = { features = ["std"], version = "0.1" }
vm-mem = { features = ["std"], version = "0.1" }
```

**ç‰¹ç‚¹**: æœ€å°åŒ–å†…å­˜å ç”¨

---

### åœºæ™¯3: ARM64ä¼˜åŒ–
```toml
[dependencies]
vm-core = { features = ["std", "arm64"], version = "0.1" }
vm-mem = { features = ["std", "opt-simd", "opt-tlb"], version = "0.1" }
```

**é¢„æœŸæå‡**: ARM64å¹³å° 15-30%

---

### åœºæ™¯4: å¼‚æ­¥æ‰§è¡Œ
```toml
[dependencies]
vm-core = { features = ["std", "async", "arm64"], version = "0.1" }
vm-mem = { features = ["std", "async", "opt-concurrent"], version = "0.1" }
```

**é€‚ç”¨**: å¼‚æ­¥JITæ‰§è¡Œå¼•æ“

---

## ğŸ”§ ç¼–è¯‘æ—¶ç‰¹æ€§é€‰æ‹©

### æ¡ä»¶ç¼–è¯‘ç¤ºä¾‹

```rust
// å¹³å°ç‰¹å®šä»£ç 
#[cfg(feature = "arm64")]
use crate::arm64::optimize;

#[cfg(feature = "x86_64")]
use crate::x86_64::optimize;

// ä¼˜åŒ–ç‰¹æ€§
#[cfg(feature = "opt-simd")]
pub fn simd_optimized() {
    // SIMDå®ç°
}

#[cfg(not(feature = "opt-simd"))]
pub fn simd_optimized() {
    // æ ‡é‡fallback
}
```

---

## ğŸ“ˆ æ€§èƒ½å½±å“æ€»ç»“

| ç‰¹æ€§ | æ€§èƒ½å½±å“ | å†…å­˜å½±å“ | é€‚ç”¨åœºæ™¯ |
|------|---------|---------|---------|
| `opt-simd` | **2-4x** (å°å‘é‡) | æ—  | å‘é‡è¿ç®— |
| `opt-tlb` | **5-15%** | æ—  | å¤§å†…å­˜ |
| `opt-numa` | **10-20%** (å¤šèŠ‚ç‚¹) | è½»å¾® | å¤šè·¯æœåŠ¡å™¨ |
| `opt-prefetch` | **5-10%** | æ—  | å¯é¢„æµ‹è®¿é—® |
| `opt-concurrent` | **5-15%** (å¤šçº¿ç¨‹) | è½»å¾® | å¤šæ ¸ç¯å¢ƒ |
| `async` | **-5%** (å¼€é”€) | å¢åŠ  | å¼‚æ­¥åœºæ™¯ |

---

## âœ… æœ€ä½³å®è·µ

### DO âœ…

1. **é»˜è®¤ä½¿ç”¨ä¼˜åŒ–ç‰¹æ€§**
   ```toml
   vm-mem = { features = ["optimizations"] }
   ```

2. **æ ¹æ®å¹³å°é€‰æ‹©**
   ```toml
   [target.'cfg(target_arch = "aarch64")']
   dependencies = { vm-core = { features = ["arm64"] } }
   ```

3. **æ˜ç¡®å¯ç”¨å¼‚æ­¥**
   ```toml
   vm-core = { features = ["async"] }
   ```

### DON'T âŒ

1. **ä¸è¦åœ¨x86_64ä¸Šå¯ç”¨arm64ç‰¹æ€§**
2. **ä¸è¦åœ¨å•èŠ‚ç‚¹ä¸Šå¯ç”¨NUMAä¼˜åŒ–** (æ— æ•ˆæœ)
3. **ä¸è¦æ··ç”¨å·²å¼ƒç”¨çš„ç‰¹æ€§**

---

## ğŸš€ å¿«é€Ÿå‚è€ƒ

### å¸¸ç”¨å‘½ä»¤

```bash
# é»˜è®¤æ„å»º
cargo build

# æœ€å¤§æ€§èƒ½
cargo build --features "vm-core/std,v-mem/optimizations"

# ARM64ä¼˜åŒ–
cargo build --features "vm-core/arm64,v-mem/opt-simd"

# å¼‚æ­¥æ”¯æŒ
cargo build --features "vm-core/async,v-mem/async"

# æ‰€æœ‰ä¼˜åŒ–
cargo build --features "vm-mem/opt-simd,v-mem/opt-tlb,v-mem/opt-numa,v-mem/opt-prefetch,v-mem/opt-concurrent"
```

---

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0 (2026-01-06)
- åˆå§‹ç‰ˆæœ¬
- æ–‡æ¡£åŒ– vm-core ç‰¹æ€§
- æ–‡æ¡£åŒ– vm-mem ç‰¹æ€§
- æ·»åŠ ä½¿ç”¨ç¤ºä¾‹

### å¾…å®Œæˆ
- [ ] æ–‡æ¡£åŒ– vm-engine-jit ç‰¹æ€§
- [ ] æ–‡æ¡£åŒ– vm-monitor ç‰¹æ€§
- [ ] æ·»åŠ æ›´å¤šä½¿ç”¨åœºæ™¯ç¤ºä¾‹
- [ ] æ€§èƒ½åŸºå‡†æµ‹è¯•æ•°æ®

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [Cargo Featuresæ–‡æ¡£](https://doc.rust-lang.org/cargo/reference/features.html)
- [æ¡ä»¶ç¼–è¯‘](https://doc.rust-lang.org/reference/conditional-compilation.html)
- [VM_COMPREHENSIVE_REVIEW_REPORT.md](../VM_COMPREHENSIVE_REVIEW_REPORT.md)

---

**ç»´æŠ¤è€…**: VM Core Team
**æ›´æ–°é¢‘ç‡**: æ¯ä¸ªç‰ˆæœ¬
**åé¦ˆ**: GitHub Issues

ğŸš€ **ä½¿ç”¨æ­£ç¡®çš„ç‰¹æ€§æ ‡å¿—ä»¥è·å¾—æœ€ä½³æ€§èƒ½!**
