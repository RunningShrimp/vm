[package]
name = "vm-service"
version = "0.1.0"
edition = "2024"

[dependencies]
vm-core = { path = "../vm-core", features = ["std"] }
vm-ir = { path = "../vm-ir" }
vm-engine = { path = "../vm-engine", features = ["interpreter", "jit"], optional = true }
vm-mem = { path = "../vm-mem" }
vm-device = { path = "../vm-device", optional = true }
vm-frontend = { path = "../vm-frontend", optional = true }
log = { workspace = true }
tokio = { workspace = true, features = ["sync", "rt-multi-thread", "time"] }
anyhow = { workspace = true }
thiserror = { workspace = true }
uuid = { workspace = true, features = ["v4"] }
tracing = { workspace = true }
parking_lot = { workspace = true }
bincode = { workspace = true }

# Optional dependencies for JIT and device support
vm-accel = { path = "../vm-accel", optional = true }
vm-smmu = { path = "../vm-smmu", optional = true }

[features]
default = ["std", "devices", "performance"]
std = []

# Performance features (merged: jit, async, frontend)
# Note: Uses all architectures by default
performance = ["std", "vm-core/async", "vm-mem/async", "vm-engine/jit", "vm-frontend/all"]

# Device support (CLINT, PLIC, virtio devices)
devices = ["vm-device"]

# Engine support (JIT and interpreter)
vm-engine = ["vm-engine/interpreter", "vm-engine/jit"]

# Frontend decoder support (single architecture)
frontend = ["vm-frontend"]
frontend-x86_64 = ["frontend", "vm-frontend/x86_64"]
frontend-arm64 = ["frontend", "vm-frontend/arm64"]
frontend-riscv64 = ["frontend", "vm-frontend/riscv64"]

# All architectures
all-arch = ["frontend", "vm-frontend/all"]

# RISC-V extensions
riscv-extensions = ["all-arch", "vm-frontend/all-extensions"]

# Legacy feature aliases (deprecated, use "performance" instead)
async = ["performance"]
jit = ["performance"]

# Hardware acceleration (CPU virtualization, SMMU, etc.)
accel = ["vm-accel"]
smmu = ["vm-accel/smmu", "devices", "vm-device/smmu", "vm-smmu"]

[dev-dependencies]
vm-mem = { path = "../vm-mem" }
tokio = { workspace = true, features = ["sync", "rt-multi-thread", "time", "macros"] }
