[package]
name = "vm-service"
version = "0.1.0"
edition = "2024"

[dependencies]
vm-core = { path = "../vm-core", features = ["std"] }
vm-ir = { path = "../vm-ir" }
vm-engine-interpreter = { path = "../vm-engine-interpreter" }
vm-mem = { path = "../vm-mem" }
vm-device = { path = "../vm-device", optional = true }
vm-frontend = { path = "../vm-frontend", optional = true }
vm-runtime = { path = "../vm-runtime" }
log = { workspace = true }
# vm-service uses: sync (types in API), rt-multi-thread (tokio::spawn), time (sleep, Duration)
tokio = { workspace = true, features = ["sync", "rt-multi-thread", "time"] }
anyhow = { workspace = true }
thiserror = { workspace = true }
uuid = { workspace = true, features = ["v4"] }
tracing = "0.1"
parking_lot = { workspace = true }
bincode = { version = "2.0", features = ["serde"] }

# Optional dependencies for JIT and device support
vm-engine-jit = { path = "../vm-engine-jit", optional = true }
vm-accel = { path = "../vm-accel", optional = true }
vm-smmu = { path = "../vm-smmu", optional = true }

[features]
default = ["std", "devices", "performance"]
std = []

# Performance features (merged: jit, async, frontend)
performance = ["std", "vm-core/async", "vm-mem/async", "vm-engine-jit", "vm-frontend"]

# Device support (CLINT, PLIC, virtio devices)
devices = ["vm-device"]

# Frontend decoder support (all architectures)
frontend = ["vm-frontend"]
all-arch = ["frontend", "vm-frontend/all"]

# Legacy feature aliases (deprecated, use "performance" instead)
async = ["performance"]
jit = ["performance"]

# Hardware acceleration (CPU virtualization, SMMU, etc.)
accel = ["vm-accel"]
smmu = ["vm-accel/smmu", "devices", "vm-device/smmu", "vm-smmu"]

[dev-dependencies]
vm-mem = { path = "../vm-mem" }
