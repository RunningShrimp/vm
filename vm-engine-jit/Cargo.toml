[package]
name = "vm-engine-jit"
version.workspace = true
edition.workspace = true

[dependencies]
vm-core = { path = "../vm-core" }
vm-ir = { path = "../vm-ir" }
vm-mem = { path = "../vm-mem" }
vm-accel = { path = "../vm-accel" }
vm-error = { path = "../vm-error" }
tracing.workspace = true
parking_lot.workspace = true
libc.workspace = true
serde.workspace = true
serde_json.workspace = true
serde_with.workspace = true
log.workspace = true
tokio.workspace = true
rand.workspace = true
criterion.workspace = true
num_cpus.workspace = true
chrono.workspace = true
thiserror.workspace = true
rayon.workspace = true
lru = "0.8"

# Cranelift依赖
cranelift = { workspace = true, optional = true }
cranelift-module = { workspace = true, optional = true }
cranelift-jit = { workspace = true, optional = true }
cranelift-native = { workspace = true, optional = true }
target-lexicon = { workspace = true, optional = true }

[dev-dependencies]
criterion.workspace = true

[features]
default = ["cranelift-backend"]
# Compilation backends
cranelift-backend = ["dep:cranelift", "dep:cranelift-module", "dep:cranelift-jit", "dep:cranelift-native", "dep:target-lexicon"]
llvm-backend = ["vm-ir/llvm"]
# Experimental features
experimental = []
# ML-guided compiler and PGO optimizer modules (merged from separate packages)
ml-guided-compiler = []
pgo-optimizer = []
