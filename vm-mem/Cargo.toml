[package]
name = "vm-mem"
version = "0.1.0"
edition = "2024"

[lib]
path = "src/lib.rs"

[dependencies]
vm-core = { path = "../vm-core" }
libc = { workspace = true }
lru = "0.16"
parking_lot = { workspace = true }
dashmap = "6.1"
crossbeam = "0.8"
crossbeam-epoch = "0.9"
crossbeam-utils = "0.8"
crossbeam-skiplist = "0.1"
async-trait = { workspace = true, optional = true }
tokio = { workspace = true, optional = true, features = ["fs"] }
thiserror = { workspace = true }

[dev-dependencies]
criterion = "0.8"
tokio = { workspace = true }
proptest = "1.0"
loom = "0.7"
rand = "0.8"

[[bench]]
name = "mmu_translate"
harness = false

[[bench]]
name = "tlb_optimized"
harness = false

[[bench]]
name = "numa_performance"
harness = false

[[bench]]
name = "async_mmu_performance"
harness = false
required-features = ["async"]

[[bench]]
name = "memory_allocation"
harness = false

[[bench]]
name = "simd_memcpy"
harness = false

[[bench]]
name = "simd_memcpy_standalone"
harness = false

[[bench]]
name = "concurrent_mmu"
harness = false

[features]
default = ["std", "optimizations"]

# Standard library support
std = []

# Fine-grained optimization features
opt-simd = []
opt-tlb = []
opt-numa = []
opt-prefetch = []
opt-concurrent = []

# Combined optimizations (included in default for backward compatibility)
optimizations = ["opt-simd", "opt-tlb", "opt-numa"]

# Async support
async = ["tokio", "async-trait"]

# Legacy feature aliases (deprecated)
tlb = ["opt-tlb"]
